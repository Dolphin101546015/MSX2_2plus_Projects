10 SCREEN 8:SET PAGE 1,1:CLS:OUT&H99,0:OUT&H99,14+128:OUT&H99,0:OUT&H99,64+32
20 CLEAR 2000:DEFINTA-Z:SET PAGE 0,0
30 _TURBO ON
40 '#C-
50 COPY(0,0)-(255,127),0 TO (0,128),0
60 _TURBO OFF
70 OPEN "grp:" FOR OUTPUT AS1
80 A$="MSX-Basic PSG-Player v2.0":C=255:Y=0:GOSUB 240
90 A$="by Dolphin_Soft (#101546015)":C=255:Y=10:GOSUB 240
100 A$="Vladivostok 2020":C=255:Y=20:GOSUB 240
110 CLOSE#1
120 OPEN "tst.psg" AS #1 LEN=255: L1 = LOF(1)/255 : P1 = 0
130 FIELD #1,255 AS A$
140 A1=PEEK(VARPTR(A$)+1):A2=PEEK(VARPTR(A$)+2)
150 GET#1
160 _TURBO ON(A1,A2)
170 AD=A1+A2*256:FOR I=0 TO 254:OUT&H98,PEEK(AD+I):NEXT I
180 _TURBO OFF
190 P1=P1+1:IF P1 <= L1 GOTO 150
200 OUT&H98,&HFD:OUT&H98,&HFD
210 CLOSE:SET PAGE 0,0
220 VDP(9)=VDP(9) OR 2:VDP(10)=VDP(10)OR2
230 GOTO 270
240 COLOR 1,0:PRESET(129-LEN(A$)*4,Y+1),0,TAND:PRINT#1, A$
250 COLOR C,0:PRESET(128-LEN(A$)*4,Y),0,TPSET:PRINT#1, A$
260 RETURN
270 _TURBO ON
280 DIMP(16)
290 DE=RND(1)*255:OUT&H99,0:OUT&H99,14+128:OUT&H99,6:DE=RND(1)*255:OUT&H99,32
300 DE=RND(1)*256
310 A=INP(&H98)
320 IF A=&HFD GOTO 290
330 IF A=&HFF THEN DE=0:Y=Y+1:GOTO 370
340 B=INP(&H98)
350 IF A=&HFE THEN DE=B*4:Y=Y+1:GOTO 370
360 P(A)=B:GOTO 310
370 IF STRIG(0) THEN GOTO 470
380 IF (VDP(-2)AND64)=0 GOTO 370
390 IF VDP(-2)AND64 GOTO 390
400 IF DE>0 THEN DE=DE-1:GOTO 370
410 S=STICK(0)
420 IF S=1 THEN VDP(10)=VDP(10)AND253
430 IF S=5 THEN VDP(10)=VDP(10)OR2
440 FOR I=0 TO 13:OUT&HA0,I:OUT&HA1,P(I):NEXT I
450 VDP(24)=Y AND 255
460 GOTO 310
470 OUT&HA0,7:OUT&HA1,&B00111111
480 IF STRIG(0) GOTO 500
490 GOTO 300
500 _TURBO OFF
510 VDP(1)=96:SCREEN 0:COLOR 15,4,4:COLOR=(4,0,1,2)
520 BEEP:END
